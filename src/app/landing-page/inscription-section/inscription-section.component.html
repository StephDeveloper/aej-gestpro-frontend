<section id="inscription" class="inscription-section">
  <div class="container">
    <div class="row text-center">
      <div class="col-12">
        <h2 class="section-title">Soumettez votre projet</h2>
        <p class="section-subtitle">Remplissez le formulaire ci-dessous pour soumettre votre projet et bénéficier d'un accompagnement personnalisé</p>
      </div>
    </div>
    
    <div class="row justify-content-center">
      <div class="col-lg-10">
        <div class="form-container">
          <div class="form-header">
            <h4 class="mb-0"><i class="fas fa-clipboard-list me-2"></i> Formulaire d'Inscription</h4>
          </div>
          <form novalidate [formGroup]="inscriptionForm" (ngSubmit)="onSubmit()" enctype="multipart/form-data">
            <div class="submit-msg-success">
              @if (successMessage) {
                <div class="alert alert-success">
                  <span class="text-success fw-bold">Succès!</span> Votre projet a été soumis avec succès.
                </div>
              }
            </div>
            <!-- Informations personnelles -->
            <div class="row">
              <div class="col-12 mb-3">
                <h5 class="form-section-title"><i class="fas fa-user me-2"></i> Informations personnelles</h5>
              </div>
              
              <div class="col-md-6 form-group">
                <label for="nom" class="form-label">Nom <span class="text-danger">*</span></label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="nom" 
                  placeholder="Entrez votre nom"
                  formControlName="nom"
                  [ngClass]="{'is-invalid': submitted && f['nom'].errors}"
                >
                @if (submitted && f['nom'].errors) {
                  <div class="invalid-feedback">
                    @if (f['nom'].errors['required']) {
                      <span>Le nom est requis</span>
                    }
                  </div>
                }
              </div>
              
              <div class="col-md-6 form-group">
                <label for="prenom" class="form-label">Prénom(s) <span class="text-danger">*</span></label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="prenom" 
                  placeholder="Entrez votre prénom"
                  formControlName="prenoms"
                  [ngClass]="{'is-invalid': submitted && f['prenoms'].errors}"
                >
                @if (submitted && f['prenoms'].errors) {
                  <div class="invalid-feedback">
                    @if (f['prenoms'].errors['required']) {
                      <span>Le prénom(s) est requis</span>
                    }
                  </div>
                }
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-md-4 form-group">
                <label for="dateNaissance" class="form-label">Date de Naissance <span class="text-danger">*</span></label>
                <input 
                  type="date" 
                  class="form-control" 
                  id="dateNaissance" 
                  formControlName="date_naissance"
                  [ngClass]="{'is-invalid': submitted && f['date_naissance'].errors}"
                >
                @if (submitted && f['date_naissance'].errors) {
                  <div class="invalid-feedback">
                    @if (f['date_naissance'].errors['required']) {
                      <span>La date de naissance est requise</span>
                    }
                  </div>
                }
              </div>
              
              <div class="col-md-4 form-group">
                <label for="lieuNaissance" class="form-label">Lieu de Naissance <span class="text-danger">*</span></label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="lieuNaissance" 
                  placeholder="Entrez votre lieu de naissance"
                  formControlName="lieu_naissance"
                  [ngClass]="{'is-invalid': submitted && f['lieu_naissance'].errors}"
                >
                @if (submitted && f['lieu_naissance'].errors) {
                  <div class="invalid-feedback">
                    @if (f['lieu_naissance'].errors['required']) {
                      <span>Le lieu de naissance est requis</span>
                    }
                  </div>
                }
              </div>
              <div class="col-md-4 form-group">
                <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                <input 
                  type="email" 
                  class="form-control" 
                  id="email" 
                  placeholder="Entrez votre email"
                  formControlName="email"
                  [ngClass]="{'is-invalid': submitted && f['email'].errors}"
                >
                @if (submitted && f['email'].errors) {
                  <div class="invalid-feedback">
                    @if (f['email'].errors['required']) {
                      <span>L'email est requis</span>
                    }
                    @if (f['email'].errors['email']) {
                      <span>L'email est invalide</span>
                    }
                  </div>
                }
              </div>
            </div>

            <!-- Informations du projet -->
            <div class="row">
              <div class="col-12 mb-3">
                <h5 class="form-section-title"><i class="fas fa-project-diagram me-2"></i> Informations du projet</h5>
              </div>
              
              <div class="col-md-6 form-group">
                <label for="typeProjet" class="form-label">Type de Projet <span class="text-danger">*</span></label>
                <select 
                  class="form-select" 
                  id="typeProjet" 
                  formControlName="type_projet"
                  [ngClass]="{'is-invalid': submitted && f['type_projet'].errors}"
                >
                  <option value="" disabled selected>Sélectionnez le type de projet</option>
                  <option value="En Développement">En Développement</option>
                  <option value="En Création">En Création</option>
                </select>
                @if (submitted && f['type_projet'].errors) {
                  <div class="invalid-feedback">
                    @if (f['type_projet'].errors['required']) {
                      <span>Le type de projet est requis</span>
                    }
                  </div>
                }
              </div>
              
              <div class="col-md-6 form-group">
                <label for="forme_juridique" class="form-label">Forme Juridique <span class="text-danger">*</span></label>
                <select 
                  class="form-select" 
                  id="forme_juridique" 
                  formControlName="forme_juridique"
                  [ngClass]="{'is-invalid': submitted && f['forme_juridique'].errors}"
                >
                  <option value="" disabled selected>Sélectionnez la forme juridique</option>
                  <option *ngFor="let forme of formesJuridiques" [value]="forme">{{ forme }}</option>
                </select>
                @if (submitted && f['forme_juridique'].errors) {
                  <div class="invalid-feedback">
                    @if (f['forme_juridique'].errors['required']) {
                      <span>La forme juridique est requise</span>
                    }
                  </div>
                }
              </div>
            </div>

            <div class="row mb-4">
              <div class="col-md-12 form-group">
                <label for="numeroCNI" class="form-label">Numéro de CNI <span class="text-danger">*</span></label>
                <input 
                  type="text" 
                  class="form-control" 
                  id="numeroCNI" 
                  placeholder="Entrez votre numéro CNI"
                  formControlName="num_cni"
                  [ngClass]="{'is-invalid': submitted && f['num_cni'].errors}"
                >
                @if (submitted && f['num_cni'].errors) {
                  <div class="invalid-feedback">
                    @if (f['num_cni'].errors['required']) {
                      <span>Le numéro CNI est requis</span>
                    }
                  </div>
                }
              </div>
            </div>

            <!-- Documents requis -->
            <div class="row mb-4">
              <div class="col-12 mb-3">
                <h5 class="form-section-title"><i class="fas fa-file-upload me-2"></i> Documents requis</h5>
                <p class="form-section-desc">Veuillez joindre les documents suivants pour compléter votre inscription</p>
              </div>
              
              <div class="col-md-4 form-group">
                <label for="cni" class="form-label">Joindre CNI <span class="text-danger">*</span></label>
                <input 
                  type="file" 
                  class="form-control" 
                  id="cni" 
                  (change)="onFileChange($event, 'cni')"
                  [ngClass]="{'is-invalid': submitted && f['cni'].errors}"
                >
                @if (submitted && f['cni'].errors) {
                  <div class="invalid-feedback">
                    @if (f['cni'].errors['required']) {
                      <span>Le fichier CNI est requis</span>
                    }
                  </div>
                }
                @if (inscriptionForm.get('cni')?.errors?.['invalidFileType']) {
                  <div class="text-danger">Format de fichier non valide</div>
                }
                @if (inscriptionForm.get('cni')?.errors?.['invalidFileSize']) {
                  <div class="text-danger">Taille du fichier trop grande</div>
                }
                <small class="form-text text-muted">Formats acceptés: PDF, JPEG, JPG, PNG (Max: 1 Mo)</small>
              </div>

              <div class="col-md-4 form-group">
                <label for="piece_identite" class="form-label">Joindre Pièce d'Identité <span class="text-danger">*</span></label>
                <input 
                  type="file" 
                  class="form-control" 
                  id="piece_identite" 
                  (change)="onFileChange($event, 'piece_identite')"
                  [ngClass]="{'is-invalid': submitted && f['piece_identite'].errors}"
                >
                @if (submitted && f['piece_identite'].errors) {
                  <div class="invalid-feedback">
                    @if (f['piece_identite'].errors['required']) {
                      <span>La pièce d'identité est requise</span>
                    }
                  </div>
                }
                @if (inscriptionForm.get('piece_identite')?.errors?.['invalidFileType']) {
                  <div class="text-danger">Format de fichier non valide</div>
                }
                @if (inscriptionForm.get('piece_identite')?.errors?.['invalidFileSize']) {
                  <div class="text-danger">Taille du fichier trop grande</div>
                }
                <small class="form-text text-muted">Formats acceptés: PDF, JPEG, JPG, PNG (Max: 1 Mo)</small>
              </div>

              <div class="col-md-4 form-group">
                <label for="plan_affaire" class="form-label">Joindre Plan d'Affaires <span class="text-danger">*</span></label>
                <input 
                  type="file" 
                  class="form-control" 
                  id="plan_affaire" 
                  (change)="onFileChange($event, 'plan_affaire')"
                  [ngClass]="{'is-invalid': submitted && f['plan_affaire'].errors}"
                >
                @if (submitted && f['plan_affaire'].errors) {
                  <div class="invalid-feedback">
                    @if (f['plan_affaire'].errors['required']) {
                      <span>Le plan d'affaires est requis</span>
                    }
                  </div>
                }
                @if (inscriptionForm.get('plan_affaire')?.errors?.['invalidFileType']) {
                  <div class="text-danger">Format de fichier non valide</div>
                }
                @if (inscriptionForm.get('plan_affaire')?.errors?.['invalidFileSize']) {
                  <div class="text-danger">Taille du fichier trop grande</div>
                }
                <small class="form-text text-muted">Formats acceptés: PDF (Max: 1 Mo)</small>
              </div>
            </div>

            <div class="submit-section">
              <p class="text-muted mb-4">En soumettant ce formulaire, vous acceptez nos conditions d'utilisation et notre politique de confidentialité.</p>
              <button type="submit" class="btn btn-primary btn-lg">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                <span *ngIf="!isLoading"><i class="fas fa-paper-plane me-2"></i></span>
                Soumettre mon projet
              </button>
            </div>
            @if (error) {
              <div class="mt-4 col-12">
                <div class="alert alert-danger">{{ error }}</div>
              </div>
            }
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
